<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Conditions d'utilisation - Admin</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { font-family: Arial, sans-serif; padding:20px; background:#f5f5f5; }
    h1 { color:#333; }
    textarea { width:100%; height:300px; margin:10px 0; padding:10px; }
    button { padding:10px 20px; cursor:pointer; margin-top:10px; }
  </style>
</head>
<body>
  <h1>Modifier les Conditions d'Utilisation</h1>
  <button onclick="window.location.href='dashboard.html'">← Retour Dashboard</button>

  <h2>Contenu actuel</h2>
  <textarea id="conditionsContent"></textarea>
  <br>
  <button onclick="updateConditions()">Enregistrer</button>

  <script>
    const supabaseUrl = "sb_publishable_Tmh4tMFfLhSGt_5oSV_6Eg_dOuBKxZL";
    const supabaseKey = "sb_secret_b_DagUO_3Xd6Te9_nz_9VA_rqhT2Ywb";
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function checkAuth() {
      const { data } = await supabase.auth.getSession();
      if (!data.session) window.location.href = "login.html";
    }
    checkAuth();

    const textarea = document.getElementById('conditionsContent');

    // Charger les conditions depuis la table
    async function loadConditions() {
      const { data, error } = await supabase.from('conditions').select('*').limit(1);
      if (error) return alert(error.message);

      if (data.length > 0) {
        textarea.value = data[0].content;
      } else {
        textarea.value = "Écrivez ici vos conditions d'utilisation...";
      }
    }

    loadConditions();

    // Mettre à jour les conditions
    async function updateConditions() {
      const content = textarea.value;
      const { data, error } = await supabase.from('conditions').upsert([{ id: 1, content }]);
      if (error) alert(error.message);
      else alert("Conditions mises à jour avec succès !");
    }
  </script>
</body>
</html>
