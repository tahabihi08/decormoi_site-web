<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Login Admin - DecorMoi</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
    <div class="login-container">
        <h1>Login Admin DecorMoi</h1>
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="votre email">
        
        <label for="password">Mot de passe</label>
        <input type="password" id="password" placeholder="votre mot de passe">
        
        <button id="btnLogin">Se connecter</button>
    </div>

    <script>
        // ================================
        // CONFIGURATION SUPABASE
        // ================================
        const supabaseUrl = 'https://fqujvrklipnufaidxqhb.supabase.co';
        const supabaseKey = 'sb_secret_b_DagUO_3Xd6Te9_nz_9VA_rqhT2Ywb';
        // Correction ici : supabase.createClient doit être appelé sur la variable globale 'supabase'
        // qui est exposée par la librairie chargée via le CDN.
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey); 

        // ================================
        // LOGIN ADMIN
        // ================================
        async function loginAdmin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (!email || !password) {
                alert("Veuillez entrer votre email et mot de passe.");
                return;
            }

            // Connexion Supabase
            const { data, error } = await supabase.auth.signInWithPassword({ email, password });

            if (error) {
                alert("Erreur login : " + error.message);
                return;
            }

            // Vérification rôle admin
            // Note : Il est crucial de s'assurer que le champ user_metadata.role est bien défini dans Supabase.
            // Une vérification de sécurité côté serveur est également fortement recommandée pour ce type de rôle.
            if (!data.user || data.user.user_metadata.role !== 'admin') {
                alert("Accès refusé : ce compte n'est pas admin");
                await supabase.auth.signOut(); // Déconnexion en cas de rôle non valide
                return;
            }

            // Redirection vers le panel admin
            window.location.href = "index.html";
        }

        // ================================
        // LIAISON DU BOUTON
        // ================================
        document.getElementById('btnLogin').addEventListener('click', loginAdmin);
    </script>
</body>
</html>



